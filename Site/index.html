<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<link rel="stylesheet" href="./style.css">


<title>Nonogram</title>

</head>
<body>

<div class="app" id="app">
    <div class="card" id="appCard">
        <div class="controls">
            <div>
              <div class="title">Nonogram</div>

              <fieldset>
                <legend style="padding:0 6px;font-weight:bold;">Controls:</legend>
                  <div class="mode-row" role="group" aria-label="modes">
                      <button id="modeMouse" class="btn active" title="Mouse mode">üñ±Ô∏è</button>
                      <button id="modeFill" class="btn" title="Black cells (filled)">‚ö´</button>
                      <button id="modeMark" class="btn" title="White cells (marked)">‚ö™</button>
                      <button id="modeErase" class="btn" title="Erase cells (clear)">üßΩ</button>
                  </div>
              </fieldset>

              <div class="legend">Mode: <span id="modeLabel">Black</span>  |  Timer: <span id="timerLabel">00:00</span></div>

              <div style="display:flex;gap:8px;">
                  <button id="resetBtn" class="btn reset">Reset</button>
                  <button id="helpBtn" class="btn reset">Help</button>
              </div>
            </div>
            

            <!-- NEW: correct count display -->
            <div class="legend">Correct: <span id="correctCount">‚Äî</span></div>
            <div class="legend">Next unlock: <span id="nextUnlockCount">‚Äî</span></div>
            <div class="legend">In logic: <span id="inLogicCount">‚Äî</span></div>
            <div class="legend">Puzzle: <span id="labelMode"></span> <a id="puzzleName" class="puzzle-link" style="color:#afb2b7;text-decoration:underline;">‚Äî</a></div>

        </div>

        <div class="board-wrap" id = "boardWrap" >
            <!-- unified board grid: clues are rendered as grid items so they align perfectly with cells -->
            <div id="boardGrid" aria-hidden="false"></div>
        </div>

    </div>
</div>

<!-- Login screen -->
<div class="login-container" id="login-container">
    <div class="login-form">
        <!-- Title with Yacht Dice - Login -->
        <h2 class="login-heading">Nonogram - Login</h2>

        <br>
        <div>
            <label for="hostport" class="login-label">Host and Port</label>
            <input type="text" id="hostport" name="hostport" class="login-input" placeholder="Example: archipelago.gg:38281">
            <label for="name" class="login-label">Player Name</label>
            <input type="text" id="name" name="name" class="login-input"
                 placeholder="Example: Yachty">
            <label for="name" class="login-label">Password</label>
            <input type="password" id="password" name="password" class="login-input" value="" placeholder="Leave blank if no password">
            <input type="submit" value="Login" id="loginbutton" class="login-submit">
            <label id="error-label" class="login-label" style="color: red;"></label>
            <fieldset>
                <legend style="padding:0 6px;font-weight:bold;">Play solo:</legend>
                <div style="display:flex;gap:8px;">
                    <button type="button" id="offline5" class="login-submit" style="background-color:#7a3434;">5x5</button>
                    <button type="button" id="offline10" class="login-submit" style="background-color:#7a3434;">10x10</button>
                    <button type="button" id="offline15" class="login-submit" style="background-color:#7a3434;">15x15</button>
                </div>
            </fieldset>
        </div>

    <div style="font-size:6px;color:#888;margin-top:8px;">
      b1.ogg b2.ogg by Pellepyb -- https://freesound.org/s/431671/ https://freesound.org/s/431670/ -- License: Creative Commons 0
    </div>
    </div>

</div>

<div class="popup-overlay" id="simple-popup" role="dialog" aria-modal="true" aria-labelledby="popup-title">
  <div class="popup" role="document">
    <h3 id="popup-title">How clues and controls work</h3>
    <ul>
      <li>You unlock clues the more squares you marked (black and white) correctly (new clues are shown in green).</li>
      <li>Controls: left-click and right-click. Middle-click to remove. Or use the modes top-left.</li>
      <li>Some clues are hidden. A <code>?</code> means there will be a clue there at some point, and it will be a number that is at least 1. Use this to logically finish the game.</li>
      <li>You don't have to guess in this puzzle, so please don't :)</li>
      <li>You can solve all puzzles by just looking at each row and column individually.</li>
      <li>Stuck? Check the console (F12) and there is a link to a spoiler log near the top that shows you the steps.</li>
    </ul>
  </div>
</div>

<!-- Simple pop-up modal -->
<style>
  .popup-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
  }
  .popup {
    background: #111;
    color: #fff;
    padding: 20px;
    max-width: 420px;
    width: calc(100% - 40px);
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    font-family: Arial, Helvetica, sans-serif;
    text-align: left;
    text-transform: none;
  }
  .popup h3 { margin: 0 0 8px 0; font-size: 1.25rem; text-transform: none;}
  .popup p { margin: 0 0 12px 0; font-size: 0.95rem; line-height: 1.35; text-transform: none;}
  .popup .actions { text-align: right; text-transform: none;}
  .popup .btn {
    background: #4a6bff;
    color: #fff;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.95rem;
    text-transform: none;
  }
  .popup .btn.secondary {
    background: transparent;
    color: #ddd;
    margin-right: 8px;
    border: 1px solid rgba(255,255,255,0.06);
  }
</style>

<script>
      (function(){
    const overlay = document.getElementById('simple-popup');
    const closeBtn = document.getElementById('popup-close');
    const gotItBtn = document.getElementById('popup-gotit');

    function reallyShowPopup() {
      overlay.style.display = 'flex';
    }
    function hidePopup() {
      overlay.style.display = 'none';
      // never show the popup again
      localStorage.setItem('popup-shown', 'true');
    }

    overlay.addEventListener('click', (e) => {
      if (e.target === overlay) hidePopup();
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && overlay.style.display === 'flex') hidePopup();
    });

    const helpBtn = document.getElementById('helpBtn');
    const STORAGE_KEY = 'popup-shown';

    if (helpBtn) {
        helpBtn.addEventListener('click', () => {
            localStorage.setItem(STORAGE_KEY, 'true');
            document.getElementById('helpBtn').style.backgroundColor = 'rgba(255,255,255,0)';
            reallyShowPopup();
        });

        if (!localStorage.getItem(STORAGE_KEY)) {
            document.getElementById('helpBtn').style.backgroundColor = '#ffffff';
        }
    }
  })();
</script>

<!-- Main application script -->

<script src="script.js"></script>
<script type="module" src="./aplogin.js"></script>
</body>
</html>